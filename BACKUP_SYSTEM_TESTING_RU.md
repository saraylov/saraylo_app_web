# Тестирование системы бэкапов Saraylo Admin

## Обзор реализации

Система бэкапов была полностью переработана для работы с реальным API сервера SvelteKit вместо mock-данных.

## Новые API endpoint'ы

### 1. Получение списка бэкапов
```
GET /api/v1/backups
```
- Требует аутентификацию (admin/editor)
- Возвращает список всех бэкапов с статистикой

### 2. Создание бэкапа
```
POST /api/v1/backups
```
- Требует аутентификацию (только admin)
- Тело запроса:
```json
{
  "description": "Описание бэкапа",
  "dataTypes": ["products", "team", "navigation"]
}
```

### 3. Получение конкретного бэкапа
```
GET /api/v1/backups/{id}
```
- Требует аутентификацию (admin/editor)

### 4. Восстановление из бэкапа
```
POST /api/v1/backups/{id}/restore
```
- Требует аутентификацию (только admin)
- Опциональное тело запроса:
```json
{
  "restoreDataTypes": ["products", "team"]
}
```

### 5. Удаление бэкапа
```
DELETE /api/v1/backups/{id}
```
- Требует аутентификацию (только admin)

## Изменения в клиентской части

### BackupService.js
- Заменены mock-вызовы на реальные API запросы
- Добавлена обработка ошибок сети
- Реализована поддержка offline-режима через localStorage

### BackupUI.js
- Обновлены методы для работы с новым API
- Улучшена обработка ошибок
- Добавлена передача типов данных при восстановлении

## Тестирование функциональности

### 1. Запуск приложений
```bash
# Запуск SvelteKit сервера
cd saraylo_app_web
npm run dev

# Запуск Electron приложения  
cd saraylo-admin-electron
npm start
```

### 2. Тестовые сценарии

#### Создание бэкапа:
1. Войти в систему как admin (admin@example.com / admin123)
2. Перейти в раздел "Управление бэкапами"
3. Нажать "Создать бэкап"
4. Выбрать типы данных и добавить описание
5. Подтвердить создание

#### Просмотр истории:
1. После создания бэкапов они должны отображаться в таблице
2. Проверить корректность отображения дат, размеров и статусов
3. Использовать фильтр поиска

#### Восстановление данных:
1. Выбрать существующий бэкап
2. Нажать кнопку восстановления
3. Подтвердить опасную операцию
4. Проверить успешное завершение

#### Удаление бэкапа:
1. Выбрать бэкап для удаления
2. Нажать кнопку удаления
3. Подтвердить удаление
4. Проверить удаление из списка

## Особенности реализации

### Безопасность:
- Все endpoint'ы защищены аутентификацией
- Разделение прав доступа (admin/editor)
- Валидация входных данных

### Надежность:
- Обработка ошибок API
- Offline-поддержка через localStorage
- Подтверждение критических операций

### Совместимость:
- Сохранение существующего интерфейса
- Интеграция с текущей системой навигации
- Соблюдение архитектурных принципов приложения

## Возможные проблемы и решения

### Проблема: Ошибки CORS
**Решение**: Проверить настройки Vite в `vite.config.ts`

### Проблема: 401 Unauthorized
**Решение**: Убедиться, что пользователь залогинен и имеет роль admin

### Проблема: Некорректные данные
**Решение**: Проверить формат JSON в запросах

## Следующие шаги для production

1. Заменить in-memory хранилище на базу данных
2. Реализовать реальный механизм бэкапа данных
3. Добавить автоматическое создание бэкапов по расписанию
4. Реализовать прогресс-бар для длительных операций
5. Добавить экспорт/импорт бэкапов в файлы

Система готова к тестированию и дальнейшей разработке.